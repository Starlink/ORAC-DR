# -*- perl -*-

=head1 NAME

_TAG_AS_REPRESENTATIVE_SPECTRUM_  -- Tag spectrum as representative

=head1 DESCRIPTION

For the relevant file, copy it to a new name with product "rsp".

=head1 ARGUMENTS

=over 4

=item FILE = STRING (Given)

By default the first file in the frame is tagged as a representative
spectrum. This argument allows an explicit file to be tagged.

=item GROUP = LOGICAL (Given)

Whether to operate on the current Frame or Group object. Defaults to
Frame. [0]

=item UPDATE = LOGICAL (Given)

If true, the output file is stored in the current frame (index 1) and tagged
as product "rsp". Default is for the file not to be put in the frame.

=back

=head1 OUTPUT DATA

=over 4

=item *

A spectrum with suffix _rsp.

=back

=head1 AUTHORS

Brad Cavanagh E<lt>b.cavanagh@jach.hawaii.eduE<gt>
Tim Jenness E<lt>t.jenness@jach.hawaii.eduE<gt>

Copyright (C) 2007, 2008 Science and Technology Facilities Council.
All Rights Reserved.

=cut

my $update = ( $_TAG_AS_REPRESENTATIVE_SPECTRUM_{UPDATE} ? 1 : 0 );
my $group = ( $_PRIM_ARGS_->{GROUP} ? 1 : 0 );
my $file;

# See if we have an override
if (exists $_PRIM_ARGS_->{FILE}) {
    # the caller has attempted to specify a file
    $file = $_PRIM_ARGS_->{FILE};

    if (!defined $file) {
        orac_carp("Attempting to tag an explicit file as a representative spectrum via an argument but no file specified. Possible programming error\n", $_PRIM_CALLERS_);
    }
} else {
    $file = $Frm->file; # default to first file in frame
}

if (defined $file) {

    (undef, my $out) = $Frm->inout("_rsp");
    $Mon{'ndfpack_mon'}->obeyw( "ndfcopy", "in=$file out=$out" );

    orac_print "$file to $out:\n Tagged as representative spectrum.\n";

    _SET_FILE_FITS_ITEM_ FILE=$out KEY=PRODUCT VALUE=rsp

    _DISPLAY_FILE_ FILE=$out GROUP=$group

    if( $update ) {
        $Frm->product( "rsp" );
        $Frm->file( $out );
    }
}

