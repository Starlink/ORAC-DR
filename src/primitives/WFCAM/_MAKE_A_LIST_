my $listfile = (defined $_MAKE_A_LIST_{LIST} ? $_MAKE_A_LIST_{LIST} : "");
my $nfile = (defined $_MAKE_A_LIST_{NFILE} ? $_MAKE_A_LIST_{NFILE} : 0);
if (! $listfile) {
    orac_throw("_MAKE_A_LIST_: No list file specified!");
} elsif ($nfile <= 0) {
    orac_throw("_MAKE_A_LIST_: Number of files must be > 0!");
}

# If the list file already exists, then open it and read what you have.
# If it doesn't already exist then create it.

use FileHandle;
my @allfiles = ();
my $fh = new FileHandle "+>> $listfile";
while (<$fh>) {
    chop;
    push @allfiles,$_;
}

# Add the new file to the list

push @allfiles,$Frm->file;
print $fh $Frm->file . "\n";
$fh->close;

# Do we have enough?

if (@allfiles == $nfile) {
    $Frm->uhdr("LIST_COMPLETE",1);
    $Frm->uhdr("FILE_LIST",\@allfiles);
    unlink $listfile;
} else {
    $Frm->uhdr("LIST_COMPLETE",0);
}

 
=head1 NAME
 
_MAKE_A_LIST_ -- Create a list of files

=head1 DESCRIPTION

A running list of frames is written to a file. Once we have enough in the file,
the list is read into memory and then the file is closed and deleted.
 
=head1 ARGUMENTS
 
=over 4
 
=item LIST = char (Given)
 
The name of the file into which to write the file names.

=item NFILE = int (Given)

The number of frames to write to the file. This will trigger reading the 
information into memory and deleting the file.
 
=back
 
=head1 NOTES
 
The $Frm->uhdr value LIST_COMPLETE is set to flag when the number of items
in the list matches the input threshold value (NFILE). When that number has
been reached then the $Frm->uhdr value FILE_LIST is set to a reference to
the array holding the names of the frames.
 
=head1 AUTHORS
 
JRL: Jim Lewis (CASU, IoA)
 
=head1 COPYRIGHT
 
Copyright (C) 2004-2007 Cambridge Astronomy Survey Unit.
All Rights Reserved
 
=cut
