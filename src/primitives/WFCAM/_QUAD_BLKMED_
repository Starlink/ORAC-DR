    # Do we need to do object masking?

    my $obmask = ($_QUAD_BLKMED_{OBMASK} ? $_QUAD_BLKMED_{OBMASK} : 0);

    # If so, then make an object mask...

    if ($obmask) {
        _MAKE_OBJECT_MASK_ PNOP=25 THRESH=3.0 GRID=64
    }

    # Do the quadrant background correction

    my ($errmsg,$retval);
    my $fname = $Frm->file;
    orac_print("Doing quadrant background block median correction on $fname\n");
    foreach my $i (1 .. $Frm->findnsubs) {
	my $frm = $Frm->getasubframe($i);
        my $opm = ($obmask ? $frm->uhdr("OPM") : 
	    ($frm->hdr("CIR_CPM") ? $frm->hdr("CIR_CPM") : ""));
	$retval = cir_qblkmed($frm->file,$opm,$errmsg);
	if ($retval != CIR_OK) {
	    orac_err("CIR_QBLKMED: failed in _QUAD_BLKMED_\n$errmsg\n");
        }
    }

    # Get rid of the object mask now

    unlink $Frm->uhdr("OPM") if ($Frm->uhdr("OPM"));

=head1 NAME

_QUAD_BLKMED_ -- Median filter quadrants to model and subtract background

=head1 DESCRIPTION

If requested an object mask is created for the current frame. The quadrants
are median filtered in order to remove any remnant 2d structure that is
repeatable in the quadrants. 

=head1 ARGUMENTS

=over 4

=item OBMASK = int (Given)

If set, then you create an object mask before filtering.

=back

=head1 NOTES

None

=head1 AUTHORS

JRL: Jim Lewis (CASU, IoA)

=head1 COPYRIGHT

Copyright (C) 2005-2008 Cambridge Astronomy Survey Unit.
All Rights Reserved

=cut
