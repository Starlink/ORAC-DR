# -*-perl-*-

=head1 NAME

_SCUBA2_HELLO_ - Mandatory introductory primitive

=head1 SYNOPSIS

 _SCUBA2_HELLO_

=head1 DESCRIPTION

This primitive should be called at the start of all SCUBA-2 DR recipes.

=head1 KNOWN ISSUES

Probably not required for non-QuickLook modes.

=head1 AUTHOR

Tim Jenness E<lt>t.jenness@jach.hawaii.eduE<gt>

=head1 COPYRIGHT

Copyright (C) 2005 Particle Physics and Astronomy Research Council.
All Rights Reserved.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307,
USA

=cut

my $duration = $Frm->uhdr("ORAC_UTEND") - 
    $Frm->uhdr("ORAC_UTSTART");
$duration = sprintf("%.1f",$duration->minutes);

# Print welcome message
orac_print "Obs #".$Frm->uhdr("ORAC_OBSERVATION_NUMBER").
    " Observing mode: ". $Frm->uhdr("ORAC_OBSERVATION_MODE").
    ( $Frm->hdr("STANDARD") ? " / standard":  "" ) .
    " / Observation duration: $duration min".
    "\n";

if ($Frm->uhdr("ORAC_OBSERVATION_TYPE") eq "focus") {
    orac_print "Focus Axis ". $Frm->hdr("FOCAXIS").
        " and focus position ". $Frm->hdr("FOCPOSN") ." mm\n";
}

# See if the OBSEND flag is set
my $obsend = ( $Frm->hdrval("OBSEND",-1) ) ? 1 : 0;

# Make an addition check for SCAN POINTING - the presence of dark
# frames prevents the obsend flag turning up in science data. For scan
# pointing observations, the source will be bright enough to detect in
# one scan so set always obsend to true regardless of how many
# subscans are in the Frame.
$obsend = 1 if ( $Frm->uhdr("ORAC_OBSERVATION_MODE") eq "scan_pointing" );

# Pass this value on to the current Frame
$Frm->uhdr("OBSEND", $obsend);

if ($Frm->hdr("SIMULATE")) {
    orac_warn(" *** This observation is simulated data! ***\n");
}


