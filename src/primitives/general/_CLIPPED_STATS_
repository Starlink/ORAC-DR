#+
# Name:
#    _CLIPPED_STATS_
#
# Purpose:
#    Finds the clipped mean and standard deviation of an object or sky frame.
#
# Language:
#    Perl5
#
# Description:
#    Use progressive sigma-clipping to find a representative mean and
#    standard deviation of an object frame.  The default clipping thresholds
#    give a reasonable approximation to the mode.
#
# Arguments:
#    CLIP = CHARACTER (Read)
#       The clipping limits as a comma-separated list. ["2,3,3"]
#    MEAN = REAL (Write)
#       The calculated clipped mean.
#    SIGMA = REAL (Write)
#       The calculated clipped standard deviation.
#    NUMBER = INTEGER (Write)
#       The number of good pixels used to derive the statistics.
#
# Notes:
#    -  This primitive is suitable for imaging instruments.
#    -  Only operates on OBJECT, SKY, DARK, LAMP, and FLAT frames.
#
# Tasks:
#    KAPPA: STATS.
#
# Authors:
#    MJC: Malcolm J. Currie (JAC, Starlink)
#
# Copyright:
#    Copyright (C) 1998-2003 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-

# Test whether or not this is an object frame.
    if ( $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "OBJECT" ||
         $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "SKY" ||
         $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "DARK" ||
         $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "LAMP" ||
         $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "FLAT" ||
         $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "SKYFLAT" ||
         $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "DOMEFLAT" ) {

# Specify the parameters for the statistics task.
       my $clip = ( $_CLIPPED_STATS_{CLIP} || "2,3,3" );
       my $param1 = "ndf=".$Frm->file;
       my $param2 = "clip=[" . $clip . "]";

# Calculate the clipped mean of the frame.
       $Mon{ "kappa_mon" }->obeyw( "stats", "$param1 $param2" );

# Extract the clipped mean and standard deviation of the frames.
       ( my $ORAC_STATUS, my $clipmean ) = $Mon{ "kappa_mon" }->get( "stats", "mean" );
       ( $ORAC_STATUS, my $clipsigma ) = $Mon{ "kappa_mon" }->get( "stats", "sigma" );
       ( $ORAC_STATUS, my $numgood ) = $Mon{ "kappa_mon" }->get( "stats", "numgood" );

# Export the values.
       $_CLIPPED_STATS_{MEAN} = $clipmean;
       $_CLIPPED_STATS_{SIGMA} = $clipsigma;
       $_CLIPPED_STATS_{NUMBER} = $numgood;
    }

# Podule
# ======

=head1 NAME

_CLIPPED_STATS_ -- Finds the clipped mean and standard deviation of an object or sky frame.

=head1 DESCRIPTION

Use progressive sigma-clipping to find a representative mean and
standard deviation of an object frame.  The default clipping thresholds
give a reasonable approximation to the mode.

=head1 ARGUMENTS

=over 4

=item CLIP = CHARACTER (Read)

The clipping limits as a comma-separated list. ["2,3,3"]

=item MEAN = REAL (Write)

The calculated clipped mean.

=item SIGMA = REAL (Write)

The calculated clipped standard deviation.

=item NUMBER = INTEGER (Write)

The number of good pixels used to derive the statistics.

=back

=head1 NOTES

=over 4

=item *

This primitive is suitable for imaging instruments.

=item *

Only operates on OBJECT, SKY, DARK, LAMP, and FLAT frames.

=back

=head1 TASKS

KAPPA: STATS.

=head1 AUTHORS

MJC: Malcolm J. Currie (JAC, Starlink)

=head1 COPYRIGHT

Copyright (C) 1998-2003 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut
