# -*-perl-*-

=head1 NAME

REDUCE_SCIENCE_ADV - Reduce an ACSIS science observation using
advanced algorithms.

=head1 DESCRIPTION

This recipe is used for advanced generic ACSIS data processing. It has
not been tuned for any specific type of data.

This recipe first creates a spatial cube from the raw time series
data. Then, working on the raw time series data, it subtracts a median
time-series signal, thresholds the data, then trims the ends of the
frequency range to remove high-noise regions.

After the time-series manipulation has been done to every member of
the current group, every member is run through MAKECUBE to create a
group spatial cube. This cube then has its baseline removed through a
smoothing process, and moments maps are created.

A baseline mask formed from the group cube is run through UNMAKECUBE
to form baseline masks for the input time-series data, which are then
baselined. The baselined time-series data are then run through
MAKECUBE to create observation cubes, from which moments maps are
created.

=head1 NOTES

=over 4

=item *

This recipe is suitable for ACSIS data.

=item *

The 'nearest' method is used for creating cubes with MAKECUBE.

=back

=head1 OUTPUT DATA

=over 4

=item *

For individual time-series data: median time-series removed with the
_tss suffix; thresholded data with the _thr suffix; frequency ends
removed with the _em suffix; baseline-only mask with the _tsmask
suffix; non-baseline regions masked with the _msk suffix; baselined
data with the _bl suffix.

=item *

For individual spatial/spectral cubes: baselined cube with the _cube suffix; baseline region mask with the _blmask suffix.

=item *

For group cubes: cube with the _cube suffix; baseline region mask with
the _blmask suffix; baselined cube with the _bl suffix;

=item *

For moments maps: integrated intensity map with the _integ suffix;
velocity map with the _iwc suffix.

=back

=head1 RELATED RECIPES

REDUCE_SCIENCE

=head1 AUTHORS

Brad Cavanagh <b.cavanagh@jach.hawaii.edu>

=head1 COPYRIGHT

Copyright (C) 2008 Science and Technology Facilities Council.
All Rights Reserved.

=cut

_REDUCE_SCIENCE_STEER_ COPY_FRAME=0

_HETERODYNE_HELLO_

_MERGE_HYBRID_MODE_

_SET_TAG_ TAG=raw

_CREATE_CUBE_FRAME_ SPREAD=nearest

_RETRIEVE_TAG_ TAG=raw

_REMOVE_FREQUENCY_ENDS_ PERCENT=5 AXIS=1

_THRESHOLD_DATA_ LOW=-150 HIGH=150 NEWLOW=bad NEWHIGH=bad

_SUBTRACT_TIMESERIES_SIGNAL_

_SET_TAG_ TAG=POST_TIMESERIES_REMOVAL

_ITERATIVE_GROUP_PRODUCTION_ SPREAD=nearest FREQUENCY_SMOOTH=25 SPATIAL_SMOOTH=3 ORDER=5 MOMENTS=integ,iwc

