\documentclass[twoside,11pt]{article}
% Used for PODs
\def\C++{{\rm C\kern-.05em\raise.3ex\hbox{\footnotesize ++}}}
\def\underscore{\leavevmode\kern.04em\vbox{\hrule width 0.4em height 0.3pt}}
\setlength{\parindent}{0pt}

% +
%  Name:
%     sun269.tex

%  Purpose:
%     SUN documentation for ORAC-DR LCOGT pipeline data reduction (SUN/269)

%  Authors:
%     Tim Lister (Las Cumbres Observatory)

%  Copyright:
%     Copyright (C) 2014-2015 Las Cumbres Observatory Global Telescope Network Inc.
%     All Rights Reserved.

%  History:
%     $Log$


% -


% ? Specify used packages
\usepackage{graphicx}        %  Use this one for final production.
% \usepackage[draft]{graphicx} %  Use this one for drafting.
% ? End of specify used packages

\pagestyle{myheadings}

% -----------------------------------------------------------------------------
% ? Document identification
% Fixed part
\newcommand{\stardoccategory}  {Starlink User Note}
\newcommand{\stardocinitials}  {SUN}
\newcommand{\stardocsource}    {sun\stardocnumber}
\newcommand{\stardoccopyright} {Copyright \copyright\ 2014--2015 Las Cumbres Observatory Global Telescope Inc.}

% Variable part - replace [xxx] as appropriate.
\newcommand{\stardocnumber}    {269.3}
\newcommand{\stardocauthors}   {Tim Lister \\
                                Las Cumbres Observatory}
\newcommand{\stardocdate}      {February 2015}
\newcommand{\stardoctitle}     {ORAC-DR -- LCOGT pipeline data reduction}
\newcommand{\stardocversion}   {0.3}
\newcommand{\stardocmanual}    {User Guide}
\newcommand{\stardocabstract}  {ORAC-DR is a
general-purpose automatic data-reduction pipeline environment.  This
document describes its use to reduce optical imaging data
collected on the Las Cumbres Observatory Global Telescope Network (LCOGT). }

% ? End of document identification
% -----------------------------------------------------------------------------

% +
%  Name:
%     sun269.tex
%
%  Purpose:
%     Documentation for LCOGT data reduction with ORAC-DR
%
%  Authors:
%     TAL: Tim Lister (LCOGT)
%
%  History:
%     03-NOV-2014 (TAL):
%        Initial version circulated to check form and function.
%     18-JAN-2015 (TAL):
%        Updated version.
%     09-FEB-2015 (TAL):
%        Add appendices with index.dqc and index.astromqc details.
%     {Add further history here}
%
% -

\newcommand{\stardocname}{\stardocinitials /\stardocnumber}
\markboth{\stardocname}{\stardocname}
\setlength{\textwidth}{160mm}
\setlength{\textheight}{230mm}
\setlength{\topmargin}{-2mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\evensidemargin}{0mm}
\setlength{\parindent}{0mm}
\setlength{\parskip}{\medskipamount}
\setlength{\unitlength}{1mm}

% -----------------------------------------------------------------------------
%  Hypertext definitions.
%  ======================
%  These are used by the LaTeX2HTML translator in conjunction with star2html.

%  Comment.sty: version 2.0, 19 June 1992
%  Selectively in/exclude pieces of text.
%
%  Author
%    Victor Eijkhout                                      <eijkhout@cs.utk.edu>
%    Department of Computer Science
%    University Tennessee at Knoxville
%    104 Ayres Hall
%    Knoxville, TN 37996
%    USA

%  Do not remove the %begin{latexonly} and %end{latexonly} lines (used by
%  LaTeX2HTML to signify text it shouldn't process).
%begin{latexonly}
\makeatletter
\def\makeinnocent#1{\catcode`#1=12 }
\def\csarg#1#2{\expandafter#1\csname#2\endcsname}

\def\ThrowAwayComment#1{\begingroup
    \def\CurrentComment{#1}%
    \let\do\makeinnocent \dospecials
    \makeinnocent\^^L% and whatever other special cases
    \endlinechar`\^^M \catcode`\^^M=12 \xComment}
{\catcode`\^^M=12 \endlinechar=-1 %
 \gdef\xComment#1^^M{\def\test{#1}
      \csarg\ifx{PlainEnd\CurrentComment Test}\test
          \let\html@next\endgroup
      \else \csarg\ifx{LaLaEnd\CurrentComment Test}\test
            \edef\html@next{\endgroup\noexpand\end{\CurrentComment}}
      \else \let\html@next\xComment
      \fi \fi \html@next}
}
\makeatother

\def\includecomment
 #1{\expandafter\def\csname#1\endcsname{}%
    \expandafter\def\csname end#1\endcsname{}}
\def\excludecomment
 #1{\expandafter\def\csname#1\endcsname{\ThrowAwayComment{#1}}%
    {\escapechar=-1\relax
     \csarg\xdef{PlainEnd#1Test}{\string\\end#1}%
     \csarg\xdef{LaLaEnd#1Test}{\string\\end\string\{#1\string\}}%
    }}

%  Define environments that ignore their contents.
\excludecomment{comment}
\excludecomment{rawhtml}
\excludecomment{htmlonly}

%  Hypertext commands etc. This is a condensed version of the html.sty
%  file supplied with LaTeX2HTML by: Nikos Drakos <nikos@cbl.leeds.ac.uk> &
%  Jelle van Zeijl <jvzeijl@isou17.estec.esa.nl>. The LaTeX2HTML documentation
%  should be consulted about all commands (and the environments defined above)
%  except \xref and \xlabel which are Starlink specific.

\newcommand{\htmladdnormallinkfoot}[2]{#1\footnote{#2}}
\newcommand{\htmladdnormallink}[2]{#1}
\newcommand{\htmladdimg}[1]{}
\newcommand{\hyperref}[4]{#2\ref{#4}#3}
\newcommand{\htmlref}[2]{#1}
\newcommand{\htmlimage}[1]{}
\newcommand{\htmladdtonavigation}[1]{}

\newenvironment{latexonly}{}{}
\newcommand{\latex}[1]{#1}
\newcommand{\html}[1]{}
\newcommand{\latexhtml}[2]{#1}
\newcommand{\HTMLcode}[2][]{}

%  Starlink cross-references and labels.
\newcommand{\xref}[3]{#1}
\newcommand{\xlabel}[1]{}

%  LaTeX2HTML symbol.
\newcommand{\latextohtml}{\LaTeX2\texttt{HTML}}

%  Define command to re-centre underscore for Latex and leave as normal
%  for HTML (severe problems with \_ in tabbing environments and \_\_
%  generally otherwise).
\renewcommand{\_}{\texttt{\symbol{95}}}

% -----------------------------------------------------------------------------
%  Debugging.
%  =========
%  Remove % on the following to debug links in the HTML version using Latex.

% \newcommand{\hotlink}[2]{\fbox{\begin{tabular}[t]{@{}c@{}}#1\\\hline{\footnotesize #2}\end{tabular}}}
% \renewcommand{\htmladdnormallinkfoot}[2]{\hotlink{#1}{#2}}
% \renewcommand{\htmladdnormallink}[2]{\hotlink{#1}{#2}}
% \renewcommand{\hyperref}[4]{\hotlink{#1}{\S\ref{#4}}}
% \renewcommand{\htmlref}[2]{\hotlink{#1}{\S\ref{#2}}}
% \renewcommand{\xref}[3]{\hotlink{#1}{#2 -- #3}}
%end{latexonly}
% -----------------------------------------------------------------------------
% ? Document specific \newcommand or \newenvironment commands.

\newcommand{\CCDPACK}{\xref{{\sc{Ccdpack}}}{sun139}{}}
\newcommand{\GAIA}{\xref{{\sc{Gaia}}}{sun214}{}}
\newcommand{\FIGARO}{\xref{{\sc{Figaro}}}{sun86}{}}
\newcommand{\KAPPA}{\xref{{\sc{Kappa}}}{sun95}{}}
\newcommand{\SMURF}{\xref{{\sc{Smurf}}}{sun258}{}}
\newcommand{\SLALIB}{\xref{{\sc{SLALIB}}}{sun67}{}}
\newcommand{\AASTROM}{\xref{{\sc{AutoAstrom}}}{sun242}{}}
\newcommand{\ASTROM}{\xref{{\sc{Astrom}}}{sun5}{}}
\newcommand{\ORACDR}{{\footnotesize ORAC-DR}}
\newcommand{\SEx}{{\sc SExtractor}}
\newcommand{\astref}{\xref{SUN/211}{sun211}{}}
\newcommand{\ndfref}{\xref{SUN/33}{sun33}{}}

\newcommand{\oracdr}{\textsc{orac-dr}}
\newcommand{\oracsun}{\xref{SUN/230}{sun230}{}}
\newcommand{\scubasun}{\xref{SUN/231}{sun231}{}}
\newcommand{\picard}{\textsc{picard}}
\newcommand{\picardsun}{\xref{SUN/265}{sun265}{}}

% Application tasks
\newcommand{\task}[1]{\textsf{#1}}
\newcommand{\makebias}{\xref{\task{makebias}}{sun139}{MAKEBIAS}}
\newcommand{\makecal}{\xref{\task{makecal}}{sun139}{MAKECAL}}
\newcommand{\makeflat}{\xref{\task{makeflat}}{sun139}{MAKEFLAT}}
\newcommand{\debias}{\xref{\task{debias}}{sun139}{DEBIAS}}
\newcommand{\calcor}{\xref{\task{calcor}}{sun139}{CALCOR}}
\newcommand{\flatcor}{\xref{\task{flatcor}}{sun139}{FLATCOR}}

% macros for typesetting parameters
\newcommand{\aparam}[1]{\texttt{#1}}     % ADAM parameter
\newcommand{\cparam}[1]{\texttt{#1}}     % CONFIG parameter
\newcommand{\ndfcomp}[1]{\texttt{#1}}    % NDF component

% LCOGT things
\newcommand{\LCO}{LCOGT}
\newcommand{\LCONet}{LCOGT Network}
\newcommand{\LCOFull}{Las Cumbres Observatory Global Telescope Network}
\newcommand{\SAICD}{LCOGT-SA-ICD Version 0.10.0}
\newcommand{\SAICDFull}{LCOGT Pipeline/Science Archive Interface Control
Document (LCOGT-SA-ICD Version 0.10.0)}
\newcommand{\SA}{Science Archive}
\newcommand{\Ast}{\texttt{timecorrect.py} code}


\newcommand{\rmn}[1] {\mathrm{#1}}
\newcommand{\arcmin}{\mbox{$^{\prime}$}}
\newcommand{\arcsec}{\mbox{$^{\prime \prime}$}}

%% Definitions imported from SUN/95

% A kind of list item, like description, but with an easily adjustable
% item separation.  Note that the paragraph and fount-size change are
% needed to make the revised \baselinestretch work.
\newlength{\menuwidth}
\newlength{\menuindent}
\newcommand{\menuitem}[2]
  {{\bf #1} \settowidth{\menuwidth}{{\bf #1} }
  \setlength{\menuindent}{-0.5em}
  \addtolength{\menuwidth}{-2\menuwidth}
  \addtolength{\menuwidth}{\textwidth}
  \addtolength{\menuwidth}{\menuindent}
  \hspace{\menuindent}\parbox[t]{\menuwidth}{
  \renewcommand{\baselinestretch}{0.75}\small
  #2 \par \vspace{1.0ex}
  \renewcommand{\baselinestretch}{1.0}\normalsize} \\ }
\begin{htmlonly}
\newcommand{\menuitem}[2]
  {\item [\htmlref{#1}{#1}] #2}
\end{htmlonly}

\newcommand{\classitem}[1]{\item [\htmlref{#1}{#1}]}

%+
%  Name:
%     SST.TEX

%  Purpose:
%     Define LaTeX commands for laying out Starlink routine descriptions.

%  Language:
%     LaTeX

%  Type of Module:
%     LaTeX data file.

%  Description:
%     This file defines LaTeX commands which allow routine documentation
%     produced by the SST application PROLAT to be processed by LaTeX and
%     by LaTeX2html. The contents of this file should be included in the
%     source prior to any statements that make of the sst commnds.

%  Notes:
%     The style file html.sty provided with LaTeX2html needs to be used.
%     This must be before this file.

%  Authors:
%     RFWS: R.F. Warren-Smith (STARLINK)
%     PDRAPER: P.W. Draper (Starlink - Durham University)

%  History:
%     10-SEP-1990 (RFWS):
%        Original version.
%     10-SEP-1990 (RFWS):
%        Added the implementation status section.
%     12-SEP-1990 (RFWS):
%        Added support for the usage section and adjusted various spacings.
%     8-DEC-1994 (PDRAPER):
%        Added support for simplified formatting using LaTeX2html.
%     21-JUL-2009 (TIMJ):
%        Added \sstdiylist{}{} as used when a Parameters section is located that
%        is not "ADAM Parameters".
%     {enter_further_changes_here}

%  Bugs:
%     {note_any_bugs_here}

%-

%  Define length variables.
\newlength{\sstbannerlength}
\newlength{\sstcaptionlength}
\newlength{\sstexampleslength}
\newlength{\sstexampleswidth}

%  Define a \tt font of the required size.
\latex{\newfont{\ssttt}{cmtt10 scaled 1095}}
\html{\newcommand{\ssttt}{\tt}}

%  Define a command to produce a routine header, including its name,
%  a purpose description and the rest of the routine's documentation.
\newcommand{\sstroutine}[3]{
   \goodbreak
   \rule{\textwidth}{0.5mm}
   \vspace{-7ex}
   \newline
   \settowidth{\sstbannerlength}{{\Large {\bf #1}}}
   \setlength{\sstcaptionlength}{\textwidth}
   \setlength{\sstexampleslength}{\textwidth}
   \addtolength{\sstbannerlength}{0.5em}
% Modifications to only print title once: see SUN232 for info
   \addtolength{\sstcaptionlength}{-1.0\sstbannerlength}
   \addtolength{\sstcaptionlength}{-2.5pt}
   \settowidth{\sstexampleswidth}{{\bf Examples:}}
   \addtolength{\sstexampleslength}{-\sstexampleswidth}
   \parbox[t]{\sstbannerlength}{\flushleft{\Large {\bf #1}}}
   \parbox[t]{\sstcaptionlength}{\center{\Large #2}}
%   \parbox[t]{\sstbannerlength}{\flushright{\Large {\bf #1}}}
   \begin{description}
      #3
   \end{description}
}

%  Format the description section.
\newcommand{\sstdescription}[1]{\item[Description:] #1}

%  Format the usage section.
\newcommand{\sstusage}[1]{\item[Usage:] \mbox{}
\\[1.3ex]{\raggedright \ssttt #1}}

%  Format the invocation section.
\newcommand{\sstinvocation}[1]{\item[Invocation:]\hspace{0.4em}{\tt #1}}

%  Format the arguments section.
\newcommand{\sstarguments}[1]{
   \item[Arguments:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the returned value section (for a function).
\newcommand{\sstreturnedvalue}[1]{
   \item[Returned Value:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the parameters section (for an application).
\newcommand{\sstparameters}[1]{
   \item[Parameters:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the examples section.
\newcommand{\sstexamples}[1]{
   \item[Examples:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Define the format of a subsection in a normal section.
\newcommand{\sstsubsection}[1]{ \item[{#1}] \mbox{} \\}

%  Define the format of a subsection in the examples section.
\newcommand{\sstexamplesubsection}[2]{\sloppy
\item[\parbox{\sstexampleslength}{\ssttt #1}] \mbox{} \vspace{1.0ex}
\\ #2 }

%  Format the notes section.
\newcommand{\sstnotes}[1]{\item[Notes:] \mbox{} \\[1.3ex] #1}

%  Provide a general-purpose format for additional (DIY) sections.
\newcommand{\sstdiytopic}[2]{\item[{\hspace{-0.35em}#1\hspace{-0.35em}:}]
\mbox{} \\[1.3ex] #2}

%  Format the a generic section as a list
\newcommand{\sstdiylist}[2]{
   \item[#1:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #2
   \end{description}
}

%  Format the implementation status section.
\newcommand{\sstimplementationstatus}[1]{
   \item[{Implementation Status:}] \mbox{} \\[1.3ex] #1}

%  Format the bugs section.
\newcommand{\sstbugs}[1]{\item[Bugs:] #1}

%  Format a list of items while in paragraph mode.
\newcommand{\sstitemlist}[1]{
  \mbox{} \\
  \vspace{-3.5ex}
  \begin{itemize}
     #1
  \end{itemize}
}

%  Define the format of an item.
\newcommand{\sstitem}{\item}

%% Now define html equivalents of those already set. These are used by
%  latex2html and are defined in the html.sty files.
\begin{htmlonly}

%  sstroutine.
   \newcommand{\sstroutine}[3]{
      \subsection{#1\xlabel{#1}-\label{#1}#2}
      \begin{description}
         #3
      \end{description}
   }

%  sstdescription
   \newcommand{\sstdescription}[1]{\item[Description:]
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstusage
   \newcommand{\sstusage}[1]{\item[Usage:]
      \begin{description}
         {\ssttt #1}
      \end{description}
      \\
   }

%  sstinvocation
   \newcommand{\sstinvocation}[1]{\item[Invocation:]
      \begin{description}
         {\ssttt #1}
      \end{description}
      \\
   }

%  sstarguments
   \newcommand{\sstarguments}[1]{
      \item[Arguments:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstreturnedvalue
   \newcommand{\sstreturnedvalue}[1]{
      \item[Returned Value:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstparameters
   \newcommand{\sstparameters}[1]{
      \item[Parameters:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstexamples
   \newcommand{\sstexamples}[1]{
      \item[Examples:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstsubsection
   \newcommand{\sstsubsection}[1]{\item[{#1}]}

%  sstexamplesubsection
   \newcommand{\sstexamplesubsection}[2]{\item[{\ssttt #1}] #2}

%  sstnotes
   \newcommand{\sstnotes}[1]{\item[Notes:] #1 }

%  sstdiytopic
   \newcommand{\sstdiytopic}[2]{\item[{#1}] #2 }

%  sstimplementationstatus
   \newcommand{\sstimplementationstatus}[1]{
      \item[Implementation Status:] #1
   }

%  sstitemlist
   \newcommand{\sstitemlist}[1]{
      \begin{itemize}
         #1
      \end{itemize}
      \\
   }
%  sstitem
   \newcommand{\sstitem}{\item}

\end{htmlonly}

%  End of "sst.tex" layout definitions.
%.

% ? End of document specific commands
% -----------------------------------------------------------------------------
%  Title Page.
%  ===========
\renewcommand{\thepage}{\roman{page}}
\begin{document}
\setcounter{secnumdepth}{5}
\thispagestyle{empty}

%  Latex document header.
%  ======================
\begin{latexonly}
   \textsc{Joint Astronomy Centre} \hfill \textbf{\stardocname}\\
   {\large Science and Technology Facilities Council}\\
   {\large Starlink Project\\ }
   {\large \stardoccategory\ \stardocnumber}
   \begin{flushright}
   \stardocauthors\\
   \stardocdate
   \end{flushright}
   \vspace{-4mm}
   \rule{\textwidth}{0.5mm}
   \vspace{5mm}
   \begin{center}
   {\Huge\textbf{\stardoctitle \\ [2.5ex]}}
   {\LARGE\textbf{\stardocversion \\ [4ex]}}
   {\Huge\textbf{\stardocmanual}}
   \end{center}
   \vspace{5mm}

% ? Add picture here if required for the LaTeX version.
%   e.g. \includegraphics[scale=0.3]{filename.ps}
\begin{center}
\begin{tabular}{cc}
\includegraphics[width=1.0in]{sun260_logo} & 
\includegraphics[height=1.0in]{sun269_logo} \\
\end{tabular}
\end{center}
% ? End of picture

% ? Heading for abstract if used.
   \vspace{10mm}
   \begin{center}
      {\Large\textbf{Abstract}}
   \end{center}
% ? End of heading for abstract.
\end{latexonly}

%  HTML documentation header.
%  ==========================
\begin{htmlonly}
   \xlabel{}
   \begin{rawhtml} <H1> \end{rawhtml}
      \stardoctitle\\
      \stardocversion\\
      \stardocmanual
   \begin{rawhtml} </H1> <HR> \end{rawhtml}

% ? Add picture here if required for the hypertext version.
%   e.g. \includegraphics[scale=0.7]{filename.ps}
\includegraphics[width=1.0in]{sun260_logo}
% ? End of picture

   \begin{rawhtml} <P> <I> \end{rawhtml}
   \stardoccategory\ \stardocnumber \\
   \stardocauthors \\
   \stardocdate
   \begin{rawhtml} </I> </P> <H3> \end{rawhtml}
      \htmladdnormallink{Joint Astronomy Centre}
                        {http://www.jach.hawaii.edu/} \\
      \htmladdnormallink{Science and Technology Facilities Council}
                        {http://www.scitech.ac.uk/} \\
   \begin{rawhtml} </H3> <H2> \end{rawhtml}
      \htmladdnormallink{Starlink Project}{http://www.starlink.ac.uk/}
   \begin{rawhtml} </H2> \end{rawhtml}
   \htmladdnormallink{\htmladdimg{source.gif} Retrieve hardcopy}
      {http://www.starlink.ac.uk/cgi-bin/hcserver?\stardocsource}\\

%  HTML document table of contents.
%  ================================
%  Add table of contents header and a navigation button to return to this
%  point in the document (this should always go before the abstract \section).
  \label{stardoccontents}
  \begin{rawhtml}
    <HR>
    <H2>Contents</H2>
  \end{rawhtml}
  \htmladdtonavigation{\htmlref{\htmladdimg{contents_motif.gif}}
        {stardoccontents}}

% ? New section for abstract if used.
  \section{\xlabel{abstract}Abstract}
% ? End of new section for abstract
\end{htmlonly}

% -----------------------------------------------------------------------------
% ? Document Abstract. (if used)
%  ==================
\stardocabstract
% ? End of document abstract

% -----------------------------------------------------------------------------
% ? Latex Copyright Statement
%  =========================
\begin{latexonly}
\newpage
\vspace*{\fill}
\stardoccopyright
\end{latexonly}
% ? End of Latex copyright statement

% -----------------------------------------------------------------------------
% ? Latex document Table of Contents (if used).
%  ===========================================
  \newpage
  \begin{latexonly}
    \setlength{\parskip}{0mm}
    \tableofcontents
    \setlength{\parskip}{\medskipamount}
    \markboth{\stardocname}{\stardocname}
  \end{latexonly}
% ? End of Latex document table of contents
% -----------------------------------------------------------------------------

\cleardoublepage
\renewcommand{\thepage}{\arabic{page}}
\setcounter{page}{1}



\section{Introduction}

Optical imaging data from the \LCOFull\ (hereafter LCOGT; \cite{brown2013lcogt})
consists of data taken from one of the LCOGT instruments; {\sc LCOSBIG}, {\sc
LCOCC}, {\sc LCOSINISTRO}, {\sc LCOSPECTRAL} or {\sc LCOFLI}.

\subsection{Document conventions}

In an attempt to make this document clearer to read, different fonts
are used for specific structures.

Observing modes are denoted by all upper case body text (e.g.\
FLATFIELD).

Starlink package names are shown in small caps (e.g.\ \SMURF);
individual task names are shown in sans-serif
(e.g.\ \makebias). \oracdr\ recipes and primitives are also shown in
sans-serif and are always upper case (e.g.\ \task{REDUCE\_BIAS}).

Content listings are shown in fixed-width type (sometimes called
`typewriter'). Extensions and components within NDF (\ndfref) data
files are shown in upper case fixed-width type (e.g.\
\ndfcomp{HISTORY}).

Text relating to filenames (including suffices for data products), key
presses or entries typed at the command line are also denoted by
fixed-width type (e.g.\ \texttt{\% kappa}), as are parameters for
tasks which are displayed in upper case (e.g.\ \aparam{METHOD}).

References to Starlink documents, i.e., Starlink User Notes (SUN),
Starlink General documents (SG) and Starlink Cookbooks (SC), are given
in the text using the document type and the corresponding number
(e.g.\ SUN/95). Non-Starlink documents are cited in the text and
listed in the bibliography.

File name suffices represent the text between the final underscore
character and the three-letter \verb+.sdf+ extension. For example, a
file named \verb+lsc1m005-fl07-20140717-0173-d02_bp.sdf+ has the suffix
\verb+_bp+.

\section{\xlabel{pipelines}LCOGT Pipeline Variants\label{se:pipelines}}

There are two variants of the LCOGT pipeline, one of which is
designed to run in real time as data comes in. Most users will only need to
run the second form, known as the offline pipeline.

\begin{itemize}
\item The quick-look (QL) pipeline is primarily designed to perform
  quality-assurance analysis of the incoming data for real-time
  assessment of the instrument performance. 

\item The offline pipeline has access to all the data observed for a
  given night/camera and adopts a best-possible reduction approach. Images
  are made for each complete observation which are combined to create
  the final image.
\end{itemize}

\subsection{Requirements for running the LCOGT pipeline}

The LCOGT pipeline requires a recent Starlink installation. The
latest version may be obtained from
\htmladdnormallink{\texttt{http://starlink.jach.hawaii.edu/starlink}}{http://starlink.jach.hawaii.edu/starlink}. Since
development of the pipeline is an ongoing process, it is recommended
that the newest builds be used to access the full capabilities of the
pipeline. These builds can be obtained from\\
\htmladdnormallink{\texttt{https://github.com/Starlink/ORAC-DR/}}{https://github.com/Starlink/ORAC-DR/}
and may be kept up-to-date with git.

The Starlink Perl installation (Starperl) must be used to run the
pipeline due to the module requirements. The Starlink environment should be
initialized as usual before running \oracdr.

The pipeline uses the following Starlink applications:
\begin{itemize}
\item \KAPPA
%\item \FIGARO
\item \CCDPACK
\item \SEx
\end{itemize}

\subsection{Important environment variables}

The pipeline uses a number of environment variables to determine where
data should be read from and written to. Some are set automatically
when the pipeline is initialized, but they can be overridden manually
and, with the \verb+-honour+ flag may be left unchanged between
successive runs of the pipeline. The variables that must be defined in
order for the pipeline to run are denoted as `Mandatory' in the list
below.

\begin{itemize}

\item \verb+STARLINK_DIR+: location of the user's Starlink
  installation. [Mandatory]

\item \verb+ORAC_DATA_IN+: the location where data are read from. If
  running with \verb+-loop flag+, this is the location of the flag
  files, rather than the data files. [Mandatory]

\item \verb+ORAC_DATA_OUT+: location where intermediate pipeline data products are
  written. [Mandatory]

\item \verb+FINAL_DATA_OUT+: final location for pipeline data products. At SBA,
  this is \\ \verb+/mfs-sba/engineering/<site>/<camera>+. If not defined, the current
  directory is assumed. [Optional]

\item \verb+ORAC_DATA_CAL+: a user-specified location for
  the library calibration files. [Mandatory]

\item \verb+ORAC_CAL_ROOT+: a user-specified location for
  pipeline configuration files. [Mandatory]

\item \verb+ORAC_INSTRUMENT+: the type of LCOGT instrument class in use e.g.
\task{LCOSINISTRO}. [Mandatory]

\item \verb+ORAC_CAMERACODE+: the type of LCOGT instrument instance in use e.g.
\task{fl07}. [Mandatory]

\item \verb+ORAC_SITECODE+: the LCOGT site code that the data is from  e.g.
\task{LSC}. [Mandatory]

\end{itemize}

\section{Running ORAC-DR}

This is a very brief introduction to running \ORACDR. More detailed
information can be found in \xref{SUN/230}{sun230}{}.
\xref{SUN/232}{sun232}{} also includes a description of how to set up
and run \ORACDR.

You must first initialise \ORACDR\ using \texttt{$\sim$eng/Setup\_Night\_ORAC.csh
<UTdate> <camera>}. This will
prepare \ORACDR\ to reduce data taken that night. If
you wish to reduce a previous nights data then you should specify the
UT date on the command line, e.g.\ \texttt{oracdr\_lcosbig 20140506 kb74}. If
necessary, you should set the \texttt{\$ORAC\_DATA\_IN} and \texttt{
  \$ORAC\_DATA\_OUT} environment variables to the names of the
directories from which the raw data should be read and to which reduced
data should be written.

For example:

\begin{verbatim}
      % source ~eng/Setup_Night_ORAC.csh 20140511 kb74
\end{verbatim}

To reduce all data for a given night you should run 

\begin{verbatim}
      oracdr -log f -verbose -file <filename of frames>
\end{verbatim}

%\textbf{XXX Not normally how things are run, add more details}
\textit{Additional details on running the pipeline will be added here or in a companion
document depending on the determined intended audience for the document
(internal LCOGT pipeline modifiers versus external (or internal) consumers of
the data who want additional details on the pipeline operation and
construction).}

%Several windows will (eventually) open: an \ORACDR\ text display, \GAIA\
%windows and \textsc{Kapview} windows (a collective term for various
%\KAPPA\ display tasks). The pipeline will reduce the data as they
%are stored to disk, using the recipe name in the image header.
%
%The pipeline is meant to run without interference from the observer.
%Thus, although you can use the various \GAIA\ tools to examine images,
%the pipeline should not need to be stopped and/or restarted. If,
%however, you do need to restart the pipeline then this can be done
%using the {\tt -from} option on the command line:
%
%\begin{verbatim}
%      oracdr -loop flag -from 19 -skip
%\end{verbatim}
%
%This will re-reduce frames from 19 onwards if they have previously
%been reduced, then continue to wait for new frames to arrive. The {\tt
%  -loop flag} tells it not to exit when it runs out of frames. When
%reducing data off-line this should be omitted. The {\tt -skip} tells it to
%skip missing observations.
%
%To re-reduce a group of
%previously stored frames you can use the {\tt -list} option to specify
%a list of frames separated by commas or ranges separated by colons:
%
%\begin{verbatim}
%      oracdr -list 15,18:20
%\end{verbatim}
%
%You may choose to reduce your data with a recipe other than the one specified
%in the file headers. If you discover narrow-line data reduction produces
%better maps than the {\tt REDUCE\_SCIENCE\_GRADIENT} recipe does, you may wish
%to specify the {\tt REDUCE\_SCIENCE\_NARROWLINE} recipe on the command line,
%for example:
%
%\begin{verbatim}
%      oracdr -loop flag -list 18:20 REDUCE\_SCIENCE\_NARROWLINE
%\end{verbatim}
%
%Further, advanced recipes are available to perform more advanced and rigorous
%data reduction than is normally carried out in real-time at the telescope. To
%use these recipes, supply the {\tt -recsuffix ADV} command-line option:
%
%\begin{verbatim}
%      oracdr -list 18:20 -recsuffix ADV
%\end{verbatim}

%The chief advantage to using the {\tt -recsuffix ADV} option instead of
%supplying the full recipe on the command-line is if the advanced recipe does
%not exist, the default standard recipe will be used instead. Thus you need not
%fear reducing pointing observations using a recipe designed for science
%targets.

%To exit (or abort) \ORACDR\ click on `Exit' in the text log window, or
%type {\tt [ctrl]-c} in the xterm. The command {\tt oracdr\_nuke} can
%be used to kill all DR-related processes, should you be having
%problems.


\section{An overview of the reduction}

The data reduction for LCOGT depends on the type of data being
reduced. Calibration observations (bias, dark, flat) are
reduced differently from science observations. 

\subsection{Bias observations}

Bias observations are used to remove the instrumental DC offset applied to the
CCD detector to ensure positive values at the ADC.

Masterbiases are created if there are enough ($>2$) raw bias frames in a
contiguous group (frames having the same `molecule number', \texttt{MOLNUM}) when
the final frame of the group is reached (i.e. when  \texttt{MOLFRNUM == 
FRMTOTAL}). The masterbias is created using the \task{REDUCE\_BIAS} recipe which
in turn calls the \task{\_MAKE\_BIAS\_FROM\_GROUP\_} primitive. This uses \CCDPACK's \makebias\ command using
the \aparam{method=median}\ combination method without zero offsetting
(\aparam{zero=false}) to combine the raw bias frames.

\subsection{Dark observations}

Dark observations are used to remove the thermal noise from the detector.

Masterdarks are created if there are enough ($>2$) raw dark frames in a
contiguous group (frames having the same `molecule number', \texttt{MOLNUM}) when
the final frame of the group is reached (i.e. when  \texttt{MOLFRNUM == 
FRMTOTAL}). The masterdark is created using the \task{REDUCE\_DARK} recipe which
in turn calls the \task{\_MAKE\_DARK\_FROM\_GROUP\_} primitive. This uses
\CCDPACK's \makecal\ command using the \aparam{method=median}\ combination
method with the \aparam{expose=} parameter set to a (created temporary) file of
the dark exposure time in order to scale the darks before combining the raw dark
frames.

\subsection{Flatfield observations}

Flat observations are used to remove the illumination variation across the field
of view and to correct for pixel to pixel sensitivity variations.

Masterflats are created if there are enough ($>3$) raw flat frames in a
contiguous group (frames having the same filter and `molecule number', \texttt{
MOLNUM}) when the final frame of the group is reached (i.e. when  \texttt{MOLFRNUM
==  FRMTOTAL}). The masterflat is created using the \task{SKY\_FLAT} recipe
which in turn calls the \task{\_MAKE\_FLAT\_FROM\_GROUP\_} primitive. This uses
\CCDPACK's \makeflat\ command to combine the raw flat frames. The combination
method and whether cleaning of bad pixels is desired are passed in from the \task{SKY\_FLAT} recipe in the call to the
\task{\_MAKE\_FLAT\_FROM\_GROUP\_} primitive and is used to set the
\aparam{method=}\ combination method and the \aparam{clean=}\ parameters, with the normal default being
\aparam{method=broadened} and \aparam{clean=f}\  (as it was found that cleaning
introduced clumps of bad pixels, particularly in the sharp edges between
Sinistro quadrants). The resulting master flat is normalised to unity.

As masterflats are constructed, the \task{\_FLAT\_QC\_} primitive will check to
see if it has found a matching pair of flats (masterflats having the same filter
and binning factors, taken from the same night (which is checked via \texttt{DAYOBS} in
the header)). Once a suitable pair is found, a difference frame is formed (using
\KAPPA's \task{sub}) and the sigma is computed. If the sigma is within
tolerance, the two flats are filed with calibration system for future use
(including making copies into the master calibration library location pointed to
by \texttt{\$ORAC\_DATA\_CAL}), otherwise the flats are removed from the
calibration system flat index.


\subsection{Imaging science observations}

This section describes the processing that happens for the science frames i.e.
the vast majority of the frames. Note that currently `standard' 
(\texttt{-s00}) frames are treated the same as science (\texttt{-e00}) frames.
The standard frames could (and there is some support within other ORAC-DR
instrument recipes) be treated differently if desired. This processing is
controlled by the \task{OFFLINE\_REDUCTION}\ recipe.

\subsubsection{Bias subtraction}

Bias subtraction and bad pixel masking are actually handled by the generic
\task{\_PREPARE\_SINGLE\_FRAME\_}\ primitive which is called from within the
recipe-specific \task{\_OFFLINE\_REDUCTION\_HELLO\_}\ primitive. The appropriate
bias and bad pixel mask to use are selected based on the normal nearest-in-time
suitable calibration frame that matches the frame's binning.

\subsubsection{Dark scaling and subtraction}

Dark scaling (the master dark has previously been scaled to an exposure time of
unity) to the science frames' exposure time and subtraction is performed by the
\task{\_SUBTRACT\_DARK\_NO\_THRESH\_}\ primitive. (The normal
\task{\_SUBTRACT\_DARK\_}\ primitve's additional thresholding behavior is not
appropriate for the LCOGT optical imaging data which is much less suspectible to
extra hot pixels). The appropriate
dark frame to use is selected based on the normal nearest-in-time
suitable calibration frame that matches the frame's binning.

\subsubsection{Flatfield normalization}

Flatfield division is performed by the \task{\_DIVIDE\_BY\_FLAT\_}\ primitive
and makes use of the \CCDPACK\ \flatcor\ task to perform the actual
correction and trimming to the trim limits. The appropriate
flatfield frame to use is selected based on the normal nearest-in-time
suitable calibration frame that matches the frame's binning and filter.

\subsubsection{Astrometric solution}

The current astrometric solver makes use of the \AASTROM\ wrapper around the
\ASTROM\ task and is controlled from within the \task{\_ADD\_AUTO\_ASTROMETRY\_}
primitive. This handles the detection and extraction of objects on the image
using \SEx\ and the download of a reference catalog to match against. The
reference catalogs are consulted in the order listed in the
\texttt{\$ORAC\_DATA\_CAL/index.skycat\_catalogue} and the default is UCAC-3
\cite{ucac3} with a fallback of 2MASS \cite{2mass} (both with two possible
server sources at CDS, France and CADC, Canada to add redundancy) and a final
fallback of the USNO-B \cite{usnob} catalog (The Context Cameras
(\texttt{LCOCC}) have a different version of
\texttt{\$ORAC\_DATA\_CAL/index.skycat\_catalogue} which only makes use of the
Tycho-2 catalog \cite{tycho2} due to the larger field of view and shallower
depth of these cameras).

The \ASTROM\ task can fit  4, 6, 7, 8, or 9 coefficients. The 4 coefficient is
never used (assumes same scale in both axes \& no shear terms), the 6
coefficient is the normal default for most cameras, the 7th term adds fitting
for the radial distortion (barrel/pincushion), the 8 coefficient fit adds
fitting for the plate center (but not distortion) and finally the 9 coefficient fit adds
fit includes fitting for the plate center along with the distortion and is the
default for the Context Cameras (\texttt{LCOCC}) due to their large field of
view.

After a putative fit, the results are sanity checked on the X and Y rms, the
number of stars used in the fit (must be $\geq$6) and the fitted platescale is
within 5\% of the expected value (which can cause false rejection if the nominal
platescale (\texttt{PIXSCALE} in the FITS header) placed by the Instrument Agent
hasn't been properly configured). The cases where the astrometric solution fails
or is reset after the sanity check are distinguished by setting \texttt{WCSERR}
in the header to '3' or '4' respectively (with '0' indicating success).

\subsubsection{Calculation of image statistics}

This occurs within the \task{\_CALCULATE\_SEEING\_STATS\_} primitive and makes
use of \SEx\ to perform the extraction and measurement of sources. A relatively
high threshold of 5.0 sigma above the background mesh fit with a minimum source
size of 12 pixels is used to avoid pushing down too far into the noise and
producing a biased result. Objects that have zero size or \SEx\
\texttt{FLAGS!=0} are removed from the calculation and then the mean FWHM,
ellipticity and orientation angle are calculated, reported in the log and filed
with the calibration system, appearing in \texttt{index.dqc}. These are subsequently
added to the header of the products as described in Section~\ref{sec:products}.

\subsubsection{Production of image catalog}

This occurs within the \task{\_CREATE\_IMAGE\_CATALOGUE\_}\ primitive and makes
use of \SEx\ to perform the source detection and extraction and produce a LCOGT
standard source catalog in the format as defined in the
\htmladdnormallink{\SAICDFull}{http://intranet.lco.gtn/Science_Archive#Interface_Control_Document_.28ICD.29}. This
extraction occurs at a lower threshold of 1.5 sigma above the background mesh
fit to give a reasonably complete source catalog without overwhelming users or
the \SA\ with spurious detections.

The \SEx\ config file is in \texttt{\$ORAC\_DATA\_CAL/extractor\_catalogue.sex}
but some elements are dynamically modified within the primitive as the \SAICD\
specification calls for aperture photometry in fixed aperture of 1\arcsec,
3\arcsec, 5\arcsec and 7\arcsec\ apertures which translates to a variable
camera-specific number of pixels, based on the platescale. The output catalog is
renamed to \texttt{$<$root name$>$10\_cat.fits} or \texttt{$<$root
name$>$90\_cat.fits} depending on whether QuickLook (indicated by
\texttt{\$Frm->uhdr( "QUICK\_LOOK" ) == 1}) or offline processing is occurring.
The output catalog is subsequently modified by the \Ast\ as further detailed in
Section~\ref{sec:timecorrect}.

\subsubsection{Calculation of zeropoint}

This makes use of the catalog of detected sources produced by the previous
\task{\_CREATE\_IMAGE\_CATALOGUE\_}\ primitive and performs a cross-match to the
combined standard star catalog produced by AJP's \task{findassm} program. The
cross match filters on distance, area (object size), ellipticity and quality
flags and surviving good matches are used to calculate the mean axial ratio of
bright sources,the sky brightness, the limiting magnitude, a transparency
estimate and the instrumental zero point. These results are reported in the log
and filed with the calibration system, appearing in \texttt{index.zeropoint}.
These are subsequently added to the header of the products as described in
Section~\ref{sec:products}.

\subsubsection{Output of derived products}
\protect\label{sec:products}

The \task{\_DERIVED\_PRODUCTS\_} primitive is used to create the derived products from the processed frames. The
following items are performed:
\begin{itemize}
\item  the headers are updated with the details of the master calibration frames
   and correction steps used,
\item  the saturation and trimmed section are updated with the values used in
   the pipeline processing,
\item  A clipped mean, median and sigma are calculated (using
\task{\_CLIPPED\_STATS\_MEDIAN\_}) and added to the header,
\item  the QC module (the \task{\_SET\_QC\_FLAGS\_}\ primitive) is run to produce the four QC flags in the headers,
\item  incorrect values of the TAGID and/or PROPID are flagged and corrected
   and the PROPID is checked against the lists of known proposals,
\item  access rights and state of the data are set,
\item  a 512$\times$512 PNG thumbnail of the processed image is created,
\item  the frame is converted to FITS format,
\item  the \Ast\ (see Section~\ref{sec:timecorrect}) is called to compute per-star barycentric time
   correction and airmass and updates the header of the BCD image and
   source catalog,
\item  if a final destination is defined by the enviroment variable
   \texttt{\$FINAL\_DATA\_OUT}, the derived products are moved there.
\end{itemize}

\subsubsection{Airmass and barycentric time correction}
\protect\label{sec:timecorrect}


In order to provide the most precise absolute timestamp that is free from
ambiguities and limited by the properties of the target system, while allowing
for improved corrections in the future, we quote the site arrival time (and
timesystem) along with the correction to the Barycentric Julian Date in the
Barycentric Dynamical Time standard (BJD$_\rmn{TDB}$; see \cite{eastman2010} for
further details). Although Barycentric Co-ordinate Time, TCB, is formally
recommended in the IAU framework (see \cite{iers2010}), it differs from the
formerly and widely used time systems such as TDB and TT by
$\sim0.5$\,s yr$^{-1}$ with a current difference of $\sim17$\,s which is likely to
lead to confusion for little benefit.

The per-star airmass and barycentric time correction is performed by
\task{timecorrect.py}\ which uses a Python-wrapped copy of the \SLALIB\ library
to perform the time and reference system transformations. This code calculates a
\ndfcomp{TCORR} column which is added to the source catalogs, before being
ingested into the archive. 

This \ndfcomp{TCORR} is the per-object complete ``time correction" to go from UTC start at the
observatory to TDB (Barycentric Dynamical Time) at the midpoint of the exposure
at the Solar System Barycenter (SSB). This \ndfcomp{TCORR} should be added to the UTC
start time to get a proper BJD$_\rmn{TDB}$. \ndfcomp{TCORR} is a collection of terms:
\begin{equation}
\texttt{TCORR} = t_{mid}+t_{clock}+t_{romer}+t_{einstein}
\end{equation}
where $t_{mid}$ is half the exposure time (to get to the midpoint), $t_{clock}$
contains the $\rmn{UTC}\rightarrow\rmn{TDB}$ correction (which is time-dependent at the few ms level as
it involves knowing the Earth's orientation and the position of the observatory
within the Solar System potential), $t_{romer}$ is the R\o emer delay (light travel
time) from the observatory to the SSB and $t_{einstein}$ is the Einstein delay due
to the fact the observatory is moving (with the Earth) and displaced from the geocenter.

The aim of the code was that code should not contribute more than 1\% error on
the shortest exposure times likely on the \LCONet, which was taken to be 30\,Hz
($=33.3\,\rmn{ms}$). The errors due to missing terms or limitations withing the
time correction code are believed to be at the few $\times\sim10\mu\rmn{s}$
level due to:
\begin{itemize}
\item Missing from the above equation is the Shapiro delay (due to the light-bending
by the Sun's gravitational potential). This effect is of the order $\sim-20\,\mu\rmn{s}$
when observing an object 30 degrees from the Sun's limb, with the effect decreasing as the
Sun$\rightarrow$object angle increases.
\item The Earth's barycentric position is calculated using the \SLALIB\
\task{sla\_epv} routine which in turn uses a simplified version of the
\texttt{VSOP2000} planetary theory \cite{vsop2000}. Comparison by TAL with the
\texttt{INPOP10a} ephemeris \cite{inpop10a} over the range 2005--2031 produced
an RMS error of 3.83\ km or $12.8\ \mu\rmn{s}$.
\item The accuracy on the mean to apparent place transformation (used for
airmass) is sub-milliarcsecond, limited by the precession-nutation model (IAU
1976 precession, Shirai \& Fukushima 2001 forced nutation and precession
corrections \cite{sf2001}), which is also used to transform the Earth's position to
J2000.0 from the true equator and equinox of date.
\item The $\rmn{UTC}\rightarrow\rmn{TT}$ correction needs to know the correct
number of leapseconds which relies on the \SLALIB\ \task{sla\_dat} routine being
updated and the code recompiled when a new leap second is announced by the IERS.
\end{itemize}

The error on the time correction is most likely to be dominated by 1)
uncertainty on the NTP synchronization of the instrument control computer
($\sim$1--5\,ms), 2) uncertainty in the time-stamping of the exposure start
($\sim 100\,\mu\rmn{s}$), and 3) uncertainty in the photon-weighted midtime of the
exposure.

\subsubsection{Photometric calibration}
Stefano's code...

\section{Data files}

\subsection{Filenames and locations}
Raw \LCO\ data conforms to the following format:\\
\texttt{<site><tel.\ class><tel.\ \#>-<inst>-YYYYMMDD-<nnnn>-<type><red.\ level>.fits}\\
where:
\begin{itemize}
\item{\texttt{<site>}} is the \LCO\ Network Site (one of \{ogg, coj, bpl, lsc, sqa, cpt, elp, tfn\}),
\item{\texttt{<tel.\ class>}} is the telescope class (one of \{2m0, 1m0, 0m8, 0m4\}),
\item{\texttt{<tel.\ \#>}} is the telescope number,
\item{\texttt{<inst>}} is the (unique) CCD descriptor,
\item{\texttt{YYYYMMDD}} is the UTC date at start of night (defined to be 16:00 local),
\item{\texttt{<nnnn>}} is the running number, restarting at 0001 when UTC date increments,
\item{\texttt{<type>}} is the type of file (from \{a=arc, b=bias, d=dark, e=exposure, f=sky flat, l=lambert flat, s=standard, x=experimental\}) 
\item{\texttt{<red.\ level>}} is the reduction level (00-99, currently one of
\{00 (raw data), 01 (flash processed), 02 (pre-processed), 10 (quicklook
processed) 90 (pipeline processed)\})
\end{itemize}

For ease of tracking data flow, the pipeline products will follow the same
policy, with the \texttt{<red.\ level>} altered appropriately to \texttt{90} in
the case of normally processed data. Catalogs derived from frames will inherit
the same rootname with a \texttt{\_cat.fits} suffix. Bitmap versions of the
frame will use the same rootname, replacing the \texttt{.fits} extension with
\texttt{.png}.

\subsection{File suffixes}

\textbf{Processing Frame suffixes}

\vspace{0.2cm}

\begin{tabular}{l c l}
\hline
Suffix & Kept & Description \hspace{9cm}  \\
\hline
\texttt{\_raw} & N & The raw frame\\
\texttt{\_bp}  & N & Bad pixels masked\\
\texttt{\_db}  & N & Bias frame removed\\
\texttt{\_bp\_db}  & N & Bad pixels masked and bias frame removed\\
\texttt{\_ff}  & N & Flat fielded\\
\hline
\end{tabular}

\vspace{0.5cm}

\textbf{Group suffixes}

\vspace{0.2cm}

Not used.

\vspace{0.5cm}

\textbf{FITS Processed Frame suffixes}

\vspace{0.2cm}

\begin{tabular}{l c l}
\hline
Suffix & Kept & Description \hspace{9cm}  \\
\hline
\texttt{\_\{a,b,d,e,f,g,w\}00} & Y & The raw frame\\
\texttt{\_\{a,b,d,e,f,g,w\}01}  & N & Pre-processed frame\\
\texttt{\_\{a,b,d,e,f,g,w\}02}  & N & Flash reduced\\
\texttt{\_\{e,s\}10}  & Y & QuickLook processed\\
\texttt{\_\{e,s\}90}  & Y & Offline processed\\
\hline
\end{tabular}


\begin{thebibliography}{}
\addcontentsline{toc}{section}{References}
\bibitem{brown2013lcogt} Brown, T.~M. et al., 2013, \textit{Las Cumbres
Observatory Global Telescope Network}, PASP, 125, 1031--1055

\bibitem{eastman2010} Eastman, J., Siverd, R. \& Gaudi, B. S., 2010, \textit{Achieving Better Than 1 Minute Accuracy in the Heliocentric and Barycentric
Julian Dates}, PASP, 122, 935

\bibitem{iers2010} Petit, G. \& Luzum, B. (eds), 2010, \textit{IERS Conventions
(2010)}, IERS Technical Note No. 36, Chap. 10

\bibitem{vsop2000} Moisson, X. \& Bretagnon, P., 2001, Celestial Mechanics and
Dynamical Astronomy, Volume 80, 3/4, 205--213

\bibitem{inpop10a} Fienga, A., Laskar, J., Kuchynka, P., Manche, H., Desvignes,
G., Gastineau, M., Cognard, I., Theureau, G., 2011, \textit{The INPOP10a
planetary ephemeris and its applications in fundamental physics}, 
Celestial Mechanics and Dynamical Astronomy, Volume 111, Issue 3, pp.363-385
DOI: 10.1007/s10569-011-9377-8

\bibitem{sf2001} Shirai, T. \& Fukushima, T., 2001, \textit{Construction of a
new forced nutation theory of the nonrigid Earth }, AJ, 121, 3270--3283. 

\bibitem{ucac3} Zacharias, N., Finch, C., Girard, T., Hambly, N.,  Wycoff, G.,
Zacharias, M.~I., Castillo, D., Corbin, T.,  DiVittorio, M., Dutta, S., Gaume,
R., Gauss, S.,  Germain, M., Hall, D., Hartkopf, W., Hsu, D.,  Holdenried, E.,
Makarov, V., Martinez, M., Mason, B.,  Monet, D., Rafferty, T., Rhodes, A.,
Siemers, T.,  Smith, D., Tilleman, T., Urban, S., Wieder, G.,  Winter, L.,
Young, A., 2010, \textit{The Third US Naval Observatory CCD Astrograph Catalog
(UCAC3)}, AJ, 139, 2184--2199.

\bibitem{2mass} Skrutskie, M.~F., Cutri, R.~M., Stiening, R.,  Weinberg, M.~D.,
Schneider, S., Carpenter, J.~M.,  Beichman, C., Capps, R., Chester, T., Elias,
J.,  Huchra, J., Liebert, J., Lonsdale, C., Monet, D.~G.,  Price, S., Seitzer,
P., Jarrett, T., Kirkpatrick, J.~D.,  Gizis, J.~E., Howard, E., Evans, T.,
Fowler, J.,  Fullmer, L., Hurt, R., Light, R., Kopan, E.~L.,  Marsh, K.~A.,
McCallon, H.~L., Tam, R., Van Dyk, S.,  Wheelock, S., \textit{The Two Micron All
Sky Survey (2MASS)}, 2006, AJ, 131, 1163--1183.

\bibitem{usnob} Monet, D.~G., Levine, S.~E., Canzian, B., Ables, H.~D., 
Bird, A.~R., Dahn, C.~C., Guetter, H.~H., Harris, H.~C.,  Henden, A.~A.,
Leggett, S.~K., Levison, H.~F.,  Luginbuhl, C.~B., Martini, J., Monet,
A.~K.~B.,  Munn, J.~A., Pier, J.~R., \textit{The USNO-B Catalog}, 2003, AJ,
125, 984--993.

\bibitem{tycho2} H{\o}g, E., Fabricius, C., Makarov, V.~V., Bastian, U., 
Schwekendiek, P., Wicenec, A., Urban, S., Corbin, T.,  Wycoff, G.,
\textit{Construction and verification of the Tycho-2 Catalogue}, 2000, A\&A,
357,367--386.

\end{thebibliography}

\newpage
\appendix

\section{\xlabel{ap_list}Alphabetical list of LCOGT Recipes\label{ap:list}}
\begin{htmlonly}
\begin{description}
\end{htmlonly}
\menuitem{OFFLINE\_REDUCTION}{
  Recipe for processing imaging science data}
\menuitem{QUICK\_LOOK}{
  QuickLook processing recipe for imaging science data}
\menuitem{REDUCE\_BIAS}{
  Process bias observations and form a masterbias}  
\menuitem{REDUCE\_DARK}{
  Process dark observations and form a masterdark}  
\menuitem{SKY\_FLAT}{
  Process sky flat observations and form a masterflat}
\begin{htmlonly}
\end{description}
\end{htmlonly}

\newpage
\begin{small}
\section{\xlabel{ap_classified}Classified list of LCOGT primitives\label{ap:classified}}

LCOGT primitives may be classified in terms of their camera class and observing
mode as follows. Note that a lot of the {\bf LCOSBIG} primitives are common to
the other instrument classes unless it has been overridden by an
instrument-specific version. The instrument-specific primitives are used in
preference to the generic ones when reducing that class of instrument data i.e.
the {\bf LCOSINISTRO} version of \task{\_MAKE\_BIAS\_FROM\_GROUP\_} will be used
instead of the {\bf LCOSBIG} one when reducing {\bf LCOSINISTRO} data.


{\large
\begin{center}
{\bf SBIG Camera (LCOSBIG) imaging data:}
\end{center}
}


{\large
\begin{center}
{\bf Bias observations}
\end{center}
}
\begin{description}
%\classitem{\_AVERAGE\_BIASES\_}
%Averages the current frame into the current bias. (deprecated)
\classitem{\_FILE\_LIBRARY\_BIAS\_}
File a copy of the masterbias SDF, PNG and calibration index files in the
calibration library
\classitem{\_MAKE\_BIAS\_FROM\_GROUP\_}
Makes a masterbias from the current group of frames.
\classitem{\_REDUCE\_BIAS\_}
Reduce a group of bias frames for array tests to determine a group (deprecated)
\classitem{\_REDUCE\_BIAS\_HELLO\_}
Sets up data-reduction tasks and data for REDUCE\_BIAS recipes.
\classitem{\_REDUCE\_BIAS\_STEER\_}
Steers processing for REDUCE\_BIAS recipe.
\classitem{\_REDUCE\_BIAS\_TIDY\_}
Removes unwanted intermediate files for the REDUCE\_BIAS recipe.
\end{description}

{\large
\begin{center}
{\bf Dark observations}
\end{center}
}
\begin{description}
\classitem{\_FILE\_LIBRARY\_DARK\_}
File a copy of the masterdark SDF, PNG and calibration index files in the
calibration library
\classitem{\_MAKE\_DARK\_FROM\_GROUP\_}
Makes a masterdark from the current group of frames.
\classitem{\_REDUCE\_DARK\_STEER\_}
Steers processing for REDUCE\_DARK recipe.
\classitem{\_REDUCE\_DARK\_TIDY\_}
Removes unwanted intermediate files for the REDUCE\_DARK recipe.
\classitem{\_REMOVE\_BIAS\_}
Subtracts a bias frame.
\end{description}

{\large
\begin{center}
{\bf Flat observations}

\end{center}
}
\begin{description}
\classitem{\_FILE\_LIBRARY\_FLAT\_}
File a copy of the masterflat SDF, PNG and calibration index files in the
calibration library
\classitem{\_FLAT\_QC\_}
To perform Quality Control on flat fields produced by this pipeline.
\classitem{\_MAKE\_FLAT\_FROM\_GROUP\_}
Makes a masterflat from the current group of frames.
\classitem{\_REMOVE\_BIAS\_}
Subtracts a bias frame.
\classitem{\_SKY\_FLAT\_STEER\_}
Steers processing for SKY\_FLAT recipes.
\classitem{\_SUBTRACT\_DARK\_}
Subtracts a dark frame.
\classitem{\_SUBTRACT\_DARK\_NO\_THRESH\_}
Subtracts a dark frame without thresholding of remaining hot pixels.
\end{description}

{\large
\begin{center}
{\bf Science observations}
\end{center}
}
\begin{description}
\classitem{\_ADD\_AUTO\_ASTROMETRY\_}
Performs automated astrometric corrections.
\classitem{\_CALCULATE\_IMAGE\_STATISTICS\_}
Calculate various image quality statistics based on an input catalog(ue).
\classitem{\_CALCULATE\_SEEING\_STATS\_}
Extract objects and determine the average FWHM, ellipticity, and position angle across a field.
\classitem{\_CALCULATE\_ZEROPOINT\_}
Calculate various image quality statistics based on an input catalogue.
\classitem{\_CREATE\_IMAGE\_CATALOGUE\_}
Performs source extraction and photometry on all sources.
\classitem{\_DATA\_QC\_TEST\_}
Evaluates the image data quality control flag and sets the relevant bitmask keywords in the data catalogue product.
\classitem{\_DERIVED\_PRODUCTS\_}
Create derived products from the processed frames.
\classitem{\_DERIVED\_PRODUCTS\_STEER\_}
Steers processing for DERIVED\_PRODUCTS recipe.
\classitem{\_DIVIDE\_BY\_FLAT\_}
Divides an object frame by a flatfield frame.
\classitem{\_IMG\_QC\_READOUT\_TEST\_}
Primitive description
\classitem{\_REMOVE\_BIAS\_}
Subtracts a bias frame.
\classitem{\_SUBTRACT\_DARK\_}
Subtracts a dark frame.
\classitem{\_SUBTRACT\_DARK\_NO\_THRESH\_}
Subtracts a dark frame without thresholding of remaining hot pixels.
\classitem{\_SET\_QC\_FLAGS\_}
Evaluate and set Quality Control flags.
\end{description}

{\large
\begin{center}
{\bf Miscellaneous}
\end{center}
}
\begin{description}
\classitem{\_ADD\_PIPELINE\_VERSION\_}
Adds the current pipeline version to the file.
\classitem{\_CHECK\_PROPID\_}
Checks whether the proposal id in the frame header is known to the science archive.
\classitem{\_CLIPPED\_STATS\_MEDIAN\_}
Finds the clipped mean, median and standard deviation of a frame.
\classitem{\_CONVERT\_TO\_FITS\_}
Converts current observation to FITS.
\classitem{\_CREATE\_GRAPHIC\_FROM\_FILE\_}
Create a PNG, GIF, or JPG graphic from a given file.
\classitem{\_CREATE\_RAW\_FRAME\_}
Creates a raw frame in ORAC\_DATA\_OUT.
\classitem{\_DELETE\_RAW\_FRAME\_}
Remove the raw frame file.
\classitem{\_GET\_FILTER\_PARAMETERS\_}
Returns LCOGT optical filter characteristics.
\classitem{\_GET\_GAIN\_}
Finds the LCOGT instrument gain in electrons per ADU for the current Frame.
\classitem{\_GET\_READNOISE\_}
Finds the LCOGT instrument readnoise in electrons for the current Frame.
\classitem{\_GET\_SATURATION\_LEVEL\_}
Finds the LCOSBIG saturation level in ADU the current Frame.
\classitem{\_IMBOX\_STATS\_}
Primitive description
\classitem{\_INSTRUMENT\_HELLO\_}
Performs the LCOSBIG-specific imaging setup.
\classitem{\_LCOGT\_STANDARD\_MAGNITUDE\_}
Obtains the catalogue magnitude of a LCOGT standard.
\classitem{\_NIGHT\_LOG\_}
Produces a text file log of a night's imaging observations.
\classitem{\_OFFLINE\_REDUCTION\_HELLO\_}
Sets up data-reduction tasks and data for OFFLINE\_REDUCTION recipes.
\classitem{\_QUICK\_LOOK\_HELLO\_}
Sets up data-reduction tasks and data for QUICK\_LOOK recipes.
\classitem{\_SET\_ORIGIN\_}
Sets the origin of an observation.
\classitem{\_STANDARD\_MAGNITUDE\_}
Obtains the catalogue magnitude of a standard.
\classitem{\_TURN\_ON\_HISTORY\_}
Switches on history recording.
\end{description}

{\large
\begin{center}
{\bf Context Camera (LCOCC) imaging data:}
\end{center}
}

\begin{description}
\classitem{\_CALCULATE\_ZEROPOINT\_NULL\_}
Null primitive for Context Camera
\classitem{\_GET\_FILTER\_PARAMETERS\_}
Fake stuff
\end{description}

{\large
\begin{center}
{\bf Sinistro Camera (LCOSINISTRO) imaging data:}
\end{center}
}

\begin{description}
\classitem{\_CALCULATE\_ZEROPOINT\_}
alculate various image quality statistics based on an input catalogue.
\classitem{\_CREATE\_IMAGE\_CATALOGUE\_}
source extraction and photometry on all sources.
\classitem{\_DERIVED\_PRODUCTS\_}
Create derived products from the processed frames.
\classitem{\_FLAT\_QC\_}
To perform Quality Control on flat fields produced by this pipeline.
\classitem{\_GET\_FILTER\_PARAMETERS\_}
Returns LCOGT optical filter characteristics.
\classitem{\_GET\_GAIN\_}
Finds the LCOGT Sinistro instrument gain in electrons per ADU for the current Frame.
\classitem{\_GET\_READNOISE\_}
Finds the LCOGT Sinistro instrument readnoise in electrons for the current Frame.
\classitem{\_GET\_SATURATION\_LEVEL\_}
Finds the LCOSINISTRO saturation level in ADU the current Frame.
\classitem{\_MAKE\_BIAS\_FROM\_GROUP\_}
Makes a masterbias from the current group of frames.
\classitem{\_MAKE\_DARK\_FROM\_GROUP\_}
Makes a masterdark from the current group of frames.
\classitem{\_MAKE\_FLAT\_FROM\_GROUP\_}
Makes a masterflat from the current group of frames.
\end{description}

{\large
\begin{center}
{\bf Spectral Instruments Camera (LCOSPECTRAL) imaging data:}
\end{center}
}

\begin{description}
\classitem{\_CREATE\_RAW\_FRAME\_}
Creates a raw frame in ORAC\_DATA\_OUT, removing legacy header items if present.
\classitem{\_GET\_GAIN\_}
Finds the LCOGT Spectral instrument gain in electrons per ADU for the current Frame.
\classitem{\_GET\_READNOISE\_}
Finds the LCOGT Spectral instrument readnoise in electrons for the current Frame.
\classitem{\_INSTRUMENT\_HELLO\_}
Performs the LCOSPECTRAL-specific imaging setup.
\classitem{\_REDUCE\_BIAS\_}
Reduce a group of bias frames for array tests to determine a group (deprecated)
\end{description}

{\large
\begin{center}
{\bf FLI Autoguider Camera (LCOFLI) imaging data:}
\end{center}
}

\begin{description}
\classitem{\_ADD\_PIPELINE\_VERSION\_}
Adds the current pipeline version to the file.
\classitem{\_CREATE\_RAW\_FRAME\_}
Creates a raw frame in ORAC\_DATA\_OUT, removing legacy header items if present.
\classitem{\_MAKE\_DARK\_FROM\_GROUP\_}
Makes a masterdark from the current group of frames.
\end{description}

{\large
\begin{center}
{\it FLOYDS Andor Camera (LCOFLOYDS) spectroscopy data:}
\end{center}
}

\begin{description}
\classitem{\_ADD\_PIPELINE\_VERSION\_}
Primitive description
\classitem{\_DETERMINE\_NREADS\_}
Primitive description
\classitem{\_DETERMINE\_WAVEBAND\_}
Primitive description
\classitem{\_FIX\_EXTRA\_HEADERS\_}
Primitive description
\classitem{\_MAKE\_BIAS\_FROM\_GROUP\_}
Primitive description
\classitem{\_MAKE\_RAW\_FILE\_}
Primitive description
\classitem{\_REDUCE\_BIAS\_}
Primitive description
\classitem{\_REDUCE\_BIAS\_HELLO\_}
Primitive description
\classitem{\_REDUCE\_BIAS\_STEER\_}
Primitive description
\classitem{\_REDUCE\_BIAS\_TIDY\_}
Primitive description
\end{description}


\end{small}

\newpage

\section{\xlabel{ap_full_recipes}Specifications of LCOGT recipes\label{ap:full_recipes}}

The following pages describe the LCOGT recipes in detail.

\newpage
\sstroutine{
   OFFLINE\_REDUCTION
}{
   Reduce a normal imaging EXPOSE observation
}{
   \sstdescription{
      It performs a debiassing, bad-pixel masking, dark subtraction,
      flat-field division, automatic astrometry, object detection and
      catalogue creation and converts to a PNG graphic and FITS version
      of the reduced frame. See the {\tt "}Notes{\tt "} for further information.
   }
   \sstnotes{
      All intermediate frames are deleted.
   }
}
\newpage
\sstroutine{
   QUICK\_LOOK
}{
   Perform a basic reduction of EXPOSE observations to give a {\tt "}quick
   look{\tt "} at the data
}{
   \sstdescription{
      It performs a debiassing, bad-pixel masking, dark subtraction,
      flat-field division, automatic astrometry, object detection and
      catalogue creation and converts to a PNG graphic and FITS version
      of the reduced frame. See the {\tt "}Notes{\tt "} for further information.
   }
   \sstnotes{
      All intermediate frames are deleted. The resulting output PNG
      graphic and FITS frames and catalog files have -\{e,s\}10.fits
      suffixes, rather than the normal -\{e,s\}90.fits
   }
}
\newpage
\sstroutine{
   REDUCE\_BIAS
}{
   Reduce a imaging BIAS observation
}{
   \sstdescription{
      Reduces a imaging BIAS observation, including coadding multiple
      integrations. Files the reduced bias frame for use by subsequent
      reduction of STARE and CHOP mode data.
   }
   \sstnotes{
      Creates a variance array for the bias frame, determined from the
      variance of the multiple integrations in the bias observation.
      There should be at least 3 integrations in a BIAS observation.
   }
   \sstdiytopic{
      See Also
   }{
      The \_REDUCE\_BIAS\_ imaging primitive.
   }
}
\newpage
\sstroutine{
   REDUCE\_DARK
}{
   Averages and files observations as the current dark
}{
   \sstdescription{
      This recipe reduces dark-frame observations from optical imaging
      data. Individual darks are scaled by the exposure time before being averaged.
      It files the single or averaged dark in the dark index file. Other
      reduction steps comprise bad-pixel masking, optional creation of
      data errors.
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         The bad-pixel mask applied is the binning-appropriate match taken from 
	 the \\ 
         \$ORAC\_DATA\_CAL/index.mask calibration index.

         \sstitem
         Intermediate frames are deleted.
      }
   }
   \sstdiylist{
      Configurable Steering Parameters
   }{
      \sstsubsection{
         USEVAR = LOGICAL
      }{
         Whether or not to create and propagate variance arrays. [0]
      }
   }
   \sstdiytopic{
      Output Data
   }{
      \sstitemlist{

         \sstitem
         The dark called dark\_$<$instrument$>$\_$<$UT
         night$>$\_$<$Xbin$>$\_$<$Ybin$>$ where $<$instrument$>$ is the LCOGT instrument identifier and $<$Xbin$>$,
         $<$Ybin$>$ are the binning factors in X and Y.

         \sstitem
         The dark is filed in \$ORAC\_DATA\_OUT/index.dark after checking whether it's
         mean is within the allowed tolerance.
         
         \sstitem
         If \$FINAL\_DATA\_OUT is set, the masterdark is converted to FITS and 
         copied there and a PNG version of the masterdark is created and moved 
         to \$FINAL\_DATA\_OUT.

      }
   }
   \sstimplementationstatus{
      \sstitemlist{

         \sstitem
         The processing engines are from the Starlink packages KAPPA and CCDPACK.

         \sstitem
         Uses the Starlink NDF format.

         \sstitem
         History is recorded within the data files.

         \sstitem
         The title of the data is propagated through the intermediate
         file to the dark.
      }
   }
}
\newpage
\sstroutine{
   SKY\_FLAT
}{
   Creates and files a flat field derived from dithered frames
}{
   \sstdescription{
      This recipe makes a sky flat for LCOGT imaging from a series of
      sky or Lambert flat frames which are combined using one of a
      selection of statistics. It expects a series of dithered sky
      frames in different filters.

      It performs debiassing, bad-pixel masking, and dark subtraction
      before combining normalised frames pixel by pixel using the
      median. Details of the flat are filed in the index of flats for
      future selection and use of the flat. See the \texttt{"}NOTES\texttt{"}  for further
      details.

      For best results the field observed should contain few stars and
      no bright ones. Ideally the telescope should have been pointed to
      the \texttt{"}flat spot\texttt{"}  - usually 5 to 10 degrees away from the zenith in
      the anti-solar direction to minimize gradients in the resultant
      flat.
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         The bad-pixel mask applied is the binning-appropriate match
         taken from the \\
         \$ORAC\_DATA\_CAL/index.mask calibration index.

         \sstitem
         Intermediate frames are deleted.
      }
   }
   \sstdiylist{
      Configurable Steering Parameters
   }{
      \sstsubsection{
         NUMBER = INTEGER
      }{
         The number of frames in the jitter. If absent, the number of
         offsets, as given by header NOFFSETS, minus one is used. If
         neither is available, 5 is used. An error state arises if the
         number of dithered frames is fewer than 3. []
      }
      \sstsubsection{
         USEVAR = LOGICAL
      }{
         Whether or not to create and propagate variance arrays. [0]
      }
   }
   \sstdiytopic{
      Output Data
   }{
      \sstitemlist{

         \sstitem
         The created flat fields are of the form \\
         flat\_$<$instrument$>$\_$<$UT
         night$>$\_$<$flattype$>$\_bin$<$Xbin$>$x$<$Ybin$>$\_$<$filter$>$[\_c$<$cycle\_number$>$]
         where $<$instrument$>$ is the LCOGT instrument identifier, $<$flattype$>$
         is the type of flat (either \texttt{'}SKYFLAT\texttt{'}  or \texttt{'}FAKEFLAT\texttt{'}  (a unity
         flat), $<$filter$>$ is the common name of the filter (e.g. \texttt{'}R\texttt{'} ) and
         $<$Xbin$>$, $<$Ybin$>$ are the binning factors in X and Y. If a flat of
         the same name already exists, a $<$cycle\_number$>$ will be added,
         counting from one.

         \sstitem
         The flats are filed in \$ORAC\_DATA\_OUT/index.flat.
      }
   }
   \sstimplementationstatus{
      \sstitemlist{

         \sstitem
         The processing engines are from the Starlink packages: CCDPACK,
         KAPPA, and FIGARO.

         \sstitem
         Uses the Starlink NDF format.

         \sstitem
         History is recorded within the data files.

         \sstitem
         The title of the data is propagated through the intermediate
         file to the dark.

         \sstitem
         Error propagation is controlled by the USEVAR parameter.
      }
   }
}

\newpage

\section{\xlabel{ap_full_primitives}Specifications of LCOGT primitives\label{ap:full_primitives}}

The following pages describe the LCOGT primitives in detail.

\include{primitives}

\newpage

\section{\xlabel{ap_qc_indexfiles}Specification of LCOGT Quality Control index files\label{ap:qc_indexfiles}}

The following pages describe the LCOGT Quality Control index files in detail.
These files are part of the calibration scheme therefore they are controlled by
LCOGT-specific subclasses of \texttt{ORAC::Calib} (found in \texttt{<ORAC-DR
root>/src/lib/perl5/ORAC/Calib/)}) namely \texttt{ORAC::Calib::LCOSBIG} (used
for the \textsc{LCOSBIG}, \textsc{LCOSBIG\_0M8} (Sedgwick),
\textsc{LCOSINISTRO}, \textsc{LCOFLI}, \textsc{LCOMEROPE} and 
\textsc{LCOSPECTRAL} instruments),  \texttt{ORAC::Calib::LCOSBIG\_0M4} (used for
\textsc{LCOSBIG\_0M4} (0.4m) instruments) and \texttt{ORAC::Calib::LCOCC} (used
for Context Camera instruments). In addition there is the basis of
low-resolution spectrographic calibration support through
\texttt{ORAC::Calib::LCOFLOYDS}.

The columns to appear in the index file are controlled by a list of column names
within a subroutine of the same name (e.g. the format of the \texttt{index.dqc}
file is controlled by a \texttt{'dqc'} subroutine) and extra columns can be
added as desired. Once defined, the ORAC-DR calibration infrastructure handles
the location, creation, indexing, updating, retrieval, consistency checking and
verification of the index files. In addition to the declared columns, columns
for the frame filename and the time are automatically created.

\subsection{\xlabel{ap_index.astromqc}Specification of the \texttt{index.astromqc} file\label{ap:index.astromqc}}

This index is used to store the result of the astrometric calibration i.e. the
WCS fit. The format of the file is a header of the column names (with a hash
character in the first column) on the first line followed by a line entry for
each frame consisting of multiple colums with the form of \texttt{<FILENAME>
OFFSETDEC OFFSETRA <ORACTIME> SECPIX XRMS YRMS} where:
\begin{itemize}
\item \texttt{<FILENAME>} is the name of the reduced frame, 
\item \texttt{NSTARS} is the number of stars used in the astrometric fit (set to 0 if
no satisfactory fit was determined), 
\item \texttt{OFFSETDEC} is the offset in Dec in arcseconds between the fitted
frame center and the Dec of the telescope (set to 0 if no satisfactory fit was determined), 
\item \texttt{OFFSETRA} is the offset in RA in arcseconds between the fitted
frame center and the RA of the telescope (set to 0 if no satisfactory fit was determined),
\item \texttt{<ORACTIME>} is the auto-inserted time of frame in standard ORAC
YYYYMMDD.ddddd format,
\item \texttt{SECPIX} is the fitted pixel scale in arcseconds/pixel (set to the
nominal pixel scale if no satisfactory fit was determined)
\item \texttt{XRMS} is the RMS of the astrometric fit in the X direction in
arcseconds (set to '-99' if no satisfactory fit was determined)
\item \texttt{YRMS} is the RMS of the astrometric fit in the X direction in
arcseconds (set to '-99' if no satisfactory fit was determined)
\end{itemize}

A section of an example file is shown below:
\begin{verbatim}
#NSTARS OFFSETDEC OFFSETRA ORACTIME SECPIX XRMS YRMS
lsc1m005-kb78-20150124-0065-s00_bp_ff 0 0 0 20150125.0169907 0.467 -99 -99
lsc1m005-kb78-20150124-0066-s00_bp_ff 0 0 0 20150125.0178704 0.467 -99 -99
lsc1m005-kb78-20150124-0067-s00_bp_ff 1 94.7442281467999 -65.0030048559793 20150125.0189352 0.4699 0.00000 0.00000
lsc1m005-kb78-20150124-0068-s00_bp_ff 1 93.4636426392003 -64.9209369759612 20150125.0209722 0.4700 0.00000 0.00000
lsc1m005-kb78-20150124-0069-s00_bp_ff 12 92.9154980000001 -64.8774346599973 20150125.0231713 0.4700 0.11851 0.07415
lsc1m005-kb78-20150124-0070-s00_bp_ff 12 92.8168515195999 -64.9570614880085 20150125.0243056 0.4700 0.11386 0
\end{verbatim}

The index file is updated by filing new astrometric fit results with the
calibration system in the \task{\_ADD\_AUTO\_ASTROMETRY\_} primitive.

\subsection{\xlabel{ap_index.dqc}Specification of the \texttt{index.dqc} file\label{ap:index.dqc}}

This index is used to store the result of the data quality control. The format of the file is a header of the column names (with a hash
character in the first column) on the first line followed by a line entry for
each frame consisting of multiple colums with the form of \texttt{<FILENAME>
AIRMASS ELLIPTICITY FWHM <ORACTIME> ORIENT QC\_OBCON QC\_IMGST QC\_CATST QC\_PHTST} where:
\begin{itemize}
\item \texttt{<FILENAME>} is the name of the reduced frame, 
\item \texttt{AIRMASS} is the mean airmass at the middle of the exposure, 
\item \texttt{ELLIPTICITY} is the mean ellipticity (0..1) of the sources in the
frame determined by \SEx\  (set to -99 if no seeing statistics were determined), 
\item \texttt{FWHM} is the mean Full Width Half Maximum in arcseconds of the
sources in the frame determined by \SEx\  (set to -99 if no seeing statistics were determined),
\item \texttt{<ORACTIME>} is the auto-inserted time of frame in standard ORAC
YYYYMMDD.ddddd format,
\item \texttt{ORIENT} is the mean orientation in degrees of the sources in the
frame fitted by \SEx\  (set to -99' if no seeing statistics were determined)
\item \texttt{QC\_CATST} is the bitmask of flags set by the QC module for the
catalog extraction (see the \SAICD\ or the \SA\ data release notes for the full
list of flags),
\item \texttt{QC\_IMGST} is the bitmask of flags set by the QC module for the
processed image (see the \SAICD\ or the \SA\ data release notes for the full
list of flags),
\item \texttt{QC\_OBCON} is the string concatanation of tests set by the QC
module for the observing constraints (see the \SAICD\ or the \SA\ data release
notes for the full list of flags),
\item \texttt{QC\_PHTST} is the bitmask of flags set by the QC module for the
photometric calibration (see the \SAICD\ or the \SA\ data release notes for the full
list of flags),
\end{itemize}

A section of an example file is shown below:
\begin{verbatim}
#AIRMASS ELLIPTICITY FWHM ORACTIME ORIENT QC_CATST QC_IMGST QC_OBCON QC_PHTST
lsc1m005-kb78-20150124-0061-s00_bp_ff 1.2029843 0.19747 2.746 20150125.0125926 23.140 1 0 UUUUU 4
lsc1m005-kb78-20150124-0062-s00_bp_ff 1.2049946 0.22837 2.723 20150125.0137037 33.649 1 0 UUUUU 4
lsc1m005-kb78-20150124-0063-s00_bp_ff 1.2072453 0.21732 2.737 20150125.0150231 25.667 1 0 UUUUU 4
lsc1m005-kb78-20150124-0064-s00_bp_ff 1.2089885 0.20205 2.628 20150125.0159259 19.913 1 0 UUUUU 4
\end{verbatim}

The index file is updated by filing new seeing statistic results with the
calibration system in the \task{\_CALCULATE\_SEEING\_STATS\_} primitive and the
index entry is updated to set the QC flags by the .\task{\_SET\_QC\_FLAGS\_} primitive

\subsection{\xlabel{ap_index.zeropoint}Specification of the \texttt{index.zeropoint} file\label{ap:index.zeropoint}}

This index is used to store the result of the per-frame photometric zeropoint
determination. The format of the file is a header of the column names (with a hash
character in the first column) on the first line followed by a line entry for
each frame consisting of multiple colums with the form of \texttt{<FILENAME>
AIRMASS EXTINCTION FILTER MAG\_LIMIT NCALOBJS <ORACTIME> SKY\_VALUE
SKY\_VALUE\_ERROR SKY\_VALUE\_MAG TRANSPARENCY Z
EROPOINT ZEROPOINT\_ERROR ZEROPOINT\_SRC} where:
\begin{itemize}
\item \texttt{<FILENAME>} is the name of the reduced frame, 
\item \texttt{AIRMASS} is the mean airmass at the middle of the exposure, 
\item \texttt{EXTINCTION} is the extinction in magnitudes/airmass in the
specific filter (set to '-99' if no photometric statistics were determined), 
\item \texttt{FILTER} is the filter used,
\item \texttt{MAG\_LIMIT} is the limiting magnitude of the frame (set to '-99' if no photometric statistics were determined), 
\item \texttt{NCALOBJS} is the number of objects used in the zeropoint
determination (set to '-99' if no photometric statistics were determined), 
\item \texttt{<ORACTIME>} is the auto-inserted time of frame in standard ORAC
YYYYMMDD.ddddd format,
\item \texttt{SKY\_VALUE} is the sky value of the frame in ADU (set to '-99' if no photometric statistics were determined), 
\item \texttt{SKY\_VALUE\_ERROR} is the variance on sky value of the frame in ADU (set to '-99' if no photometric statistics were determined), 
\item \texttt{SKY\_VALUE\_MAG} is the sky value of the frame in magnitudes (set to '-99' if no photometric statistics were determined), 
\item \texttt{TRANSPARENCY} is the estimated transparency (0..1) of the frame
(set to '-99'' if no photometric statistics were determined),
\item \texttt{ZEROPOINT} is the zeropoint of the frame in magnitudes
(set to '-99'' if no photometric statistics were determined),
\item \texttt{ZEROPOINT\_ERROR} is the error on the zeropoint of the frame in magnitudes
(set to '-99' if no photometric statistics were determined),
\item \texttt{ZEROPOINT\_SRC} is the source of the zeropoint determination
(normally \texttt{<primitive name>-version}; set to 'N/A' if no photometric statistics were determined),
\end{itemize}

A section of an example file is shown below:
\begin{verbatim}
#AIRMASS EXTINCTION FILTER MAG_LIMIT NCALOBJS ORACTIME SKY_VALUE SKY_VALUE_ERROR SKY_VALUE_MAG TRANSPARENCY ZEROPOINT ZEROPOINT_ERROR ZEROPOINT_SRC
lsc1m005-kb78-20150124-0351-e00_bp_ff 1.9601564 -99 gp -99 0 20150125.3628819 -99 -99 -99 -99 -99 -99 N/A
lsc1m005-kb78-20150124-0352-e00_bp_ff 1.90434185 -99 gp -99 0 20150125.3665509 -99 -99 -99 -99 -99 -99 N/A
lsc1m005-kb78-20150124-0364-e00_bp_ff 1.6940621 0.076346831 rp 15.87 7 20150125.3884028 49.1304748347854 10.8466273708444 17.2630570207312 0.316227766016838 24.65 0.168283194819187 _CALCULATE_ZEROPOINT_-r6338
\end{verbatim}

The index file is updated by filing new per-frame zeropoint determination results with the
calibration system in the \task{\_CALCULATE\_ZEROPOINT\_} primitive.

\end{document}
